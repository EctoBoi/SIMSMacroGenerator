<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMS Macro Generator</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f4f9; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .warning-box {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .warning-icon { margin-right: 10px; font-size: 1.5em; }

        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab-btn {
            padding: 15px 30px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab-btn:hover { color: #007bff; background-color: #f8f9fa; }
        .tab-btn.active { color: #007bff; border-bottom: 3px solid #007bff; }

        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; }
        th { background-color: #f1f3f5; font-weight: 700; color: #495057; }
        
        input { width: 90%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        input:focus { border-color: #007bff; outline: none; box-shadow: 0 0 0 3px rgba(0,123,255,0.1); }
        
        button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 4px; font-weight: bold; transition: background 0.2s; }
        .btn-add { background-color: #28a745; color: white; margin-right: 10px;}
        .btn-add:hover { background-color: #218838; }
        .btn-paste { background-color: #6f42c1; color: white; margin-right: 10px;}
        .btn-paste:hover { background-color: #59359a; }
        .btn-gen { background-color: #007bff; color: white; font-size: 1em; padding: 12px 24px; }
        .btn-gen:hover { background-color: #0069d9; }
        .btn-del { background-color: #dc3545; color: white; padding: 6px 12px; font-size: 0.9em; }
        .btn-del:hover { background-color: #c82333; }

        .controls { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
        .error-msg { color: #dc3545; font-weight: bold; display: none; margin-right: 15px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="warning-box">
        <span class="warning-icon">‚ö†Ô∏è</span>
        IMPORTANT: These macros MUST be run from the "SIMS RF Menu".
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('homeTab')">UPDATE HOME</button>
        <button class="tab-btn" onclick="openTab('moveTab')">MOVE SKU</button>
    </div>

    <div id="homeTab" class="tab-content active">
        <p>Sets PRIMARY and updates Min/Max values for SKUs in specified slots.</p>
        <table id="homeTable">
            <thead>
                <tr>
                    <th>SKU Number</th>
                    <th>Slot Location</th>
                    <th>Max</th>
                    <th>Min</th>
                    <th style="width: 50px;"></th>
                </tr>
            </thead>
            <tbody id="homeBody"></tbody>
        </table>
        <div class="controls">
            <button class="btn-add" onclick="addHomeRow()">+ Add Row</button>
            <div>
                <span id="homeError" class="error-msg">Fill all fields!</span>
                <button class="btn-gen" onclick="generateHomeMacro()">Download Home Macro</button>
            </div>
        </div>
    </div>

    <div id="moveTab" class="tab-content">
        <p>Moves a quantity of a SKU from one slot to another.</p>
        <table id="moveTable">
            <thead>
                <tr>
                    <th>SKU Number</th>
                    <th>From Slot</th>
                    <th>To Slot</th>
                    <th>Quantity</th>
                    <th style="width: 50px;"></th>
                </tr>
            </thead>
            <tbody id="moveBody"></tbody>
        </table>
        <div class="controls">
            <div>
                <button class="btn-add" onclick="addMoveRow()">+ Add Row</button>
                <button class="btn-paste" onclick="pasteMoveData()">üìã Paste from Clipboard</button>
            </div>
            <div>
                <span id="moveError" class="error-msg">Fill all fields!</span>
                <button class="btn-gen" onclick="generateMoveMacro()">Download Move SKU Macro</button>
            </div>
        </div>
    </div>
</div>

<script>
    const HEADER = `<HAScript name="GENERATED_MACRO" description="" timeout="60000" pausetime="300" promptall="true" blockinput="true" author="" creationdate="" supressclearevents="false" usevars="false" ignorepauseforenhancedtn="true" delayifnotenhancedtn="0" ignorepausetimeforenhancedtn="true" continueontimeout="false">`;
    const FOOTER = `\n</HAScript>`;
    
    document.addEventListener('DOMContentLoaded', () => {
        addHomeRow();
        addMoveRow();
    });

    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        const btnIndex = tabName === 'homeTab' ? 0 : 1;
        document.querySelectorAll('.tab-btn')[btnIndex].classList.add('active');
    }

    function removeRow(btn) {
        const row = btn.parentNode.parentNode;
        const tbody = row.parentNode;
        if (tbody.rows.length > 1) { row.remove(); } 
        else { row.querySelectorAll('input').forEach(i => i.value = ''); }
    }

    function addHomeRow() {
        const tbody = document.getElementById('homeBody');
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="text" placeholder="e.g. 1811215" class="sku-input"></td>
            <td><input type="text" placeholder="e.g. FX02A001" class="slot-input"></td>
            <td><input type="number" placeholder="e.g. 6" class="max-input"></td>
            <td><input type="number" placeholder="e.g. 3" class="min-input"></td>
            <td><button class="btn-del" onclick="removeRow(this)">X</button></td>
        `;
        tbody.appendChild(tr);
    }

    function addMoveRow(sku='', from='', to='', qty='') {
        const tbody = document.getElementById('moveBody');
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="text" value="${sku}" placeholder="e.g. 3791994" class="sku-input"></td>
            <td><input type="text" value="${from}" placeholder="e.g. GF02B000" class="from-slot-input"></td>
            <td><input type="text" value="${to}" placeholder="e.g. CMDA0100" class="to-slot-input"></td>
            <td><input type="number" value="${qty}" placeholder="e.g. 2" class="qty-input"></td>
            <td><button class="btn-del" onclick="removeRow(this)">X</button></td>
        `;
        tbody.appendChild(tr);
        return tr;
    }

    async function pasteMoveData() {
        try {
            const text = await navigator.clipboard.readText();
            const parts = text.split(',').map(part => part.trim());
            
            if (parts.length < 4) {
                alert("Clipboard does not match format: SKU,FromSlot,ToSlot,Quantity");
                return;
            }

            const [sku, from, to, qty] = parts;
            const tbody = document.getElementById('moveBody');
            const lastRow = tbody.lastElementChild;
            const inputs = lastRow.querySelectorAll('input');
            
            // Check if last row is empty to reuse it, otherwise add new
            const isEmpty = Array.from(inputs).every(i => i.value === "");
            
            if (isEmpty) {
                inputs[0].value = sku;
                inputs[1].value = from;
                inputs[2].value = to;
                inputs[3].value = qty;
            } else {
                addMoveRow(sku, from, to, qty);
            }
        } catch (err) {
            alert("Failed to read clipboard. Please ensure you have given permission.");
        }
    }

    // Note: Placeholders for your existing macro generation logic
    function generateHomeMacro() { alert("Logic to generate Home Macro goes here."); }
    function generateMoveMacro() { alert("Logic to generate Move Macro goes here."); }

</script>
</body>
</html>
